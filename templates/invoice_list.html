{% extends "base.html" %}

{% block title %}💰 Invoices{% endblock %}

{% block content %}
<div class="page-title-container">
  <h1 class="page-title">💰 Invoices</h1>
  <div class="title-nav-buttons">
    <a href="/invoices/create" class="btn-base btn-accent">
      ➕ New Invoice
    </a>
  </div>
</div>

<!-- Financial Summary -->
<div class="card-base" style="padding: 1rem;">
  <div class="row text-center g-3">
    <div class="col-md-4">
      <div class="h3 mb-0" style="color: var(--navy); font-weight: bold;">£{{ "%.2f"|format(total_unpaid) }}</div>
      <div class="text-muted" style="font-size: 0.8rem;">Outstanding</div>
    </div>
    <div class="col-md-4">
      <div class="h3 mb-0" style="color: var(--teal); font-weight: bold;">£{{ "%.2f"|format(total_paid) }}</div>
      <div class="text-muted" style="font-size: 0.8rem;">Received</div>
    </div>
    <div class="col-md-4">
      <div class="h3 mb-0" style="color: var(--danger, #dc3545); font-weight: bold;">{{ num_overdue }}</div>
      <div class="text-muted" style="font-size: 0.8rem;">Overdue</div>
    </div>
  </div>
</div>

<!-- Unpaid Invoices Section -->
<div class="card-base" style="padding: 1rem;">
  <h4 class="section-title" style="margin-bottom: 1rem;">💸 Unpaid ({{ unpaid_invoices|length }})</h4>
  
  {% if unpaid_invoices %}
    <div class="row g-2">
      {% for invoice in unpaid_invoices %}
        <div class="col-lg-4 col-md-6">
          <div class="card-border-left" style="border-left-color: {% if invoice.status == 'overdue' %}var(--danger, #dc3545){% else %}var(--warning, #ffc107){% endif %}; position: relative; padding: 0.75rem;">
            
            <!-- Compact Status Badge -->
            <div style="position: absolute; top: 0; right: 0; background: {% if invoice.status == 'overdue' %}var(--danger, #dc3545){% else %}var(--warning, #ffc107){% endif %}; color: white; padding: 2px 6px; font-size: 0.6rem; font-weight: bold; border-bottom-left-radius: 4px;">
              {{ invoice.status|upper }}
            </div>
            
            <!-- Invoice Info -->
            <div class="mb-2">
              <div class="h6 mb-0" style="line-height: 1.2;">{{ invoice.client_name }}</div>
              <div class="text-muted" style="font-size: 0.75rem; line-height: 1.1;">{{ invoice.description[:40] }}{% if invoice.description|length > 40 %}...{% endif %}</div>
            </div>
            
            <!-- Amount and Dates -->
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="h5 mb-0" style="color: var(--navy);">£{{ "%.0f"|format(invoice.amount) }}</div>
              <div class="text-end">
                <div style="font-size: 0.65rem; color: var(--text-muted);">{{ invoice.invoice_number }}</div>
                <div style="font-size: 0.65rem; color: var(--text-muted);">Due {{ invoice.due_date[5:] }}</div>
              </div>
            </div>
            
            <!-- Compact Action Buttons -->
            <div class="d-flex gap-1">
              <form action="/invoices/mark-paid/{{ invoice.id }}" method="POST" class="flex-fill">
                <button type="submit" class="btn-base btn-success w-100" style="padding: 4px 6px; font-size: 0.7rem;">✅ Paid</button>
              </form>
              <a href="/invoices/view/{{ invoice.id }}" class="btn-base btn-outline-accent" style="padding: 4px 6px; font-size: 0.7rem;">👁️</a>
              <a href="/invoices/duplicate/{{ invoice.id }}" class="btn-base btn-outline-secondary" style="padding: 4px 6px; font-size: 0.7rem;">📋</a>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="text-center" style="padding: 20px;">
      <div style="font-size: 32px; margin-bottom: 10px;">💯</div>
      <p class="text-muted mb-0">No unpaid invoices!</p>
    </div>
  {% endif %}
</div>

<!-- Paid Invoices Section -->
<div class="card-base" style="padding: 1rem;">
  <h4 class="section-title" style="margin-bottom: 1rem;">✅ Paid ({{ paid_invoices|length }})</h4>
  
  {% if paid_invoices %}
    <div class="row g-2">
      {% for invoice in paid_invoices %}
        <div class="col-lg-4 col-md-6">
          <div class="card-border-left" style="border-left-color: var(--success, #28a745); opacity: 0.9; position: relative; padding: 0.75rem;">
            
            <!-- Compact Status Badge -->
            <div style="position: absolute; top: 0; right: 0; background: var(--success, #28a745); color: white; padding: 2px 6px; font-size: 0.6rem; font-weight: bold; border-bottom-left-radius: 4px;">
              PAID
            </div>
            
            <!-- Invoice Info -->
            <div class="mb-2">
              <div class="h6 mb-0" style="line-height: 1.2;">{{ invoice.client_name }}</div>
              <div class="text-muted" style="font-size: 0.75rem; line-height: 1.1;">{{ invoice.description[:40] }}{% if invoice.description|length > 40 %}...{% endif %}</div>
            </div>
            
            <!-- Amount and Dates -->
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="h5 mb-0" style="color: var(--success, #28a745);">£{{ "%.0f"|format(invoice.amount) }}</div>
              <div class="text-end">
                <div style="font-size: 0.65rem; color: var(--text-muted);">{{ invoice.invoice_number }}</div>
                <div style="font-size: 0.65rem; color: var(--text-muted);">Paid {{ invoice.paid_date[5:] if invoice.paid_date else "?" }}</div>
              </div>
            </div>
            
            <!-- Compact Action Buttons -->
            <div class="d-flex gap-1">
              <a href="/invoices/view/{{ invoice.id }}" class="btn-base btn-outline-accent flex-fill" style="padding: 4px 6px; font-size: 0.7rem;">👁️ View</a>
              <a href="/invoices/duplicate/{{ invoice.id }}" class="btn-base btn-outline-secondary" style="padding: 4px 6px; font-size: 0.7rem;">📋</a>
              <form action="/invoices/delete/{{ invoice.id }}" method="POST" class="d-inline" onsubmit="return confirm('Delete?')">
                <button type="submit" class="btn-base btn-outline-danger" style="padding: 4px 6px; font-size: 0.7rem;">🗑️</button>
              </form>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="text-center" style="padding: 20px;">
      <div style="font-size: 32px; margin-bottom: 10px;">💰</div>
      <p class="text-muted mb-0">No payment history yet.</p>
    </div>
  {% endif %}
</div>

{% if not unpaid_invoices and not paid_invoices %}
  <!-- Empty State for No Invoices -->
  <div class="card-base text-center">
    <div style="padding: 40px 20px;">
      <div style="font-size: 48px; margin-bottom: 15px;">📝</div>
      <h4 class="mb-3">No Invoices Yet</h4>
      <p class="mb-4 text-muted">Create your first invoice to get started!</p>
      <a href="/invoices/create" class="btn-base btn-accent">
        ✨ Create Your First Invoice
      </a>
    </div>
  </div>
{% endif %}
{% endblock %}