{% extends "base.html" %}

{% block title %}💰 Invoices{% endblock %}

{% block content %}
<div class="page-title-container">
  <h1 class="page-title">💰 Invoices</h1>
  <div class="title-nav-buttons">
    <a href="/invoices/create" class="btn-base btn-accent">➕ New Invoice</a>
  </div>
</div>

<!-- Financial Summary -->
<div class="card-base">
  <div class="row text-center g-3">
    <div class="col-md-4 col-6">
      <div class="summary-card" style="background: linear-gradient(135deg, var(--warning), #e67e22); color: white; padding: 1rem; border-radius: 12px;">
        <div class="h3 mb-0 font-bold">£{{ "%.0f"|format(total_unpaid) }}</div>
        <div style="font-size: 0.9rem; opacity: 0.9;">Outstanding</div>
      </div>
    </div>
    <div class="col-md-4 col-6">
      <div class="summary-card" style="background: linear-gradient(135deg, var(--teal), var(--teal-dark)); color: white; padding: 1rem; border-radius: 12px;">
        <div class="h3 mb-0 font-bold">£{{ "%.0f"|format(total_paid) }}</div>
        <div style="font-size: 0.9rem; opacity: 0.9;">Received</div>
      </div>
    </div>
    <div class="col-md-4 col-12">
      <div class="summary-card" style="background: linear-gradient(135deg, var(--danger), #c0392b); color: white; padding: 1rem; border-radius: 12px;">
        <div class="h3 mb-0 font-bold">{{ num_overdue }}</div>
        <div style="font-size: 0.9rem; opacity: 0.9;">Overdue</div>
      </div>
    </div>
  </div>
</div>

<!-- Unpaid Invoices -->
{% if unpaid_invoices %}
<div class="card-base">
  <h4 class="section-title">💸 Unpaid Invoices ({{ unpaid_invoices|length }})</h4>
  
  <div class="row g-3">
    {% for invoice in unpaid_invoices %}
    <div class="col-lg-6 col-xl-4">
      <div class="card-border-left invoice-card" 
           style="border-left-color: {% if invoice.status == 'overdue' %}var(--danger){% else %}var(--warning){% endif %};">
        
        <!-- Status Badge -->
        <div class="d-flex justify-content-between align-items-start mb-2">
          <h6 class="mb-0">{{ invoice.client_name }}</h6>
          <span class="badge-base {% if invoice.status == 'overdue' %}status-danger{% else %}status-warning{% endif %}">
            {{ invoice.status|upper }}
          </span>
        </div>
        
        <!-- Description -->
        <p class="text-muted small mb-2">{{ invoice.description[:50] }}{% if invoice.description|length > 50 %}...{% endif %}</p>
        
        <!-- Amount & Details -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div class="invoice-amount">£{{ "%.2f"|format(invoice.amount) }}</div>
          <div class="text-end text-muted small">
            <div>{{ invoice.invoice_number }}</div>
            <div>Due {{ invoice.due_date }}</div>
          </div>
        </div>
        
        <!-- Actions -->
        <div class="d-flex gap-2 flex-wrap">
          <form action="/invoices/mark-paid/{{ invoice.id }}" method="POST" class="flex-fill">
            <button type="submit" class="btn-base btn-success w-100">✅ Mark Paid</button>
          </form>
          <a href="/invoices/view/{{ invoice.id }}" class="btn-base btn-outline-accent">👁️</a>
          <a href="/invoices/duplicate/{{ invoice.id }}" class="btn-base btn-outline-secondary">📋</a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}

<!-- Paid Invoices -->
{% if paid_invoices %}
<div class="card-base">
  <h4 class="section-title">✅ Paid Invoices ({{ paid_invoices|length }})</h4>
  
  <div class="row g-3">
    {% for invoice in paid_invoices %}
    <div class="col-lg-6 col-xl-4">
      <div class="card-border-left invoice-card" style="border-left-color: var(--success); opacity: 0.95;">
        
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-start mb-2">
          <h6 class="mb-0">{{ invoice.client_name }}</h6>
          <span class="badge-base status-success">PAID</span>
        </div>
        
        <!-- Description -->
        <p class="text-muted small mb-2">{{ invoice.description[:50] }}{% if invoice.description|length > 50 %}...{% endif %}</p>
        
        <!-- Amount & Details -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div class="invoice-amount" style="color: var(--success);">£{{ "%.2f"|format(invoice.amount) }}</div>
          <div class="text-end text-muted small">
            <div>{{ invoice.invoice_number }}</div>
            <div>Paid {{ invoice.paid_date if invoice.paid_date else "?" }}</div>
          </div>
        </div>
        
        <!-- Actions -->
        <div class="d-flex gap-2">
          <a href="/invoices/view/{{ invoice.id }}" class="btn-base btn-outline-accent flex-fill">👁️ View</a>
          <a href="/invoices/duplicate/{{ invoice.id }}" class="btn-base btn-outline-secondary">🔄</a>
          <form action="/invoices/delete/{{ invoice.id }}" method="POST" onsubmit="return confirm('Delete this invoice?')">
            <button type="submit" class="btn-base btn-outline-danger">🗑️</button>
          </form>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}

<!-- Empty State -->
{% if not unpaid_invoices and not paid_invoices %}
<div class="card-base text-center">
  <div class="empty-state">
    <div class="empty-icon">📝</div>
    <h4 class="mb-3">No Invoices Yet</h4>
    <p class="mb-4 text-muted">Create your first invoice to start tracking payments.</p>
    <a href="/invoices/create" class="btn-base btn-accent btn-lg">✨ Create First Invoice</a>
  </div>
</div>
{% endif %}
{% endblock %}