{% extends "base.html" %}

{% block title %}üìã Invoice Templates{% endblock %}

{% block content %}
<div class="page-title-container">
  <h1 class="page-title">üìã Invoice Templates</h1>
  <div class="title-nav-buttons">
    <a href="/invoices" class="btn-base btn-outline-accent">‚Üê Back to Invoices</a>
  </div>
</div>

<!-- Create New Template -->
<div class="card-base p-4 mb-4">
  <h4 class="section-title mb-4">‚ûï Create New Template</h4>
  <form method="POST" action="/invoices/templates/create">
    
    <div class="row g-3 mb-3">
      <div class="col-md-6">
        <label class="form-label">Template Name *</label>
        <input type="text" name="name" class="input-base form-control"
               placeholder="e.g. Private Lesson, Group Session" required>
      </div>
      <div class="col-md-6">
        <label class="form-label">Amount (¬£) *</label>
        <input type="number" name="amount" class="input-base form-control"
               placeholder="0.00" step="0.01" min="0" required>
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Service Description *</label>
      <input type="text" name="description" class="input-base form-control"
             placeholder="e.g. 1-hour private tennis lesson" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Notes (optional)</label>
      <textarea name="notes" class="input-base form-control" rows="2"
                placeholder="e.g. Payment due within 7 days"></textarea>
    </div>

    <div class="mt-4">
      <button type="submit" class="btn-base btn-accent">
        ‚úÖ Create Template
      </button>
    </div>
    
  </form>
</div>


<!-- Existing Templates -->
<div class="card-base">
  <h4 class="section-title">Your Templates ({{ templates|length }})</h4>
  
  {% if templates %}
    <div class="row g-3">
      {% for template in templates %}
        <div class="col-lg-6">
          <div class="card-border-left hover-subtle">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <div class="flex-grow-1">
                <h5 class="mb-1 font-medium">{{ template.name }}</h5>
                <p class="text-sm text-muted mb-2">{{ template.description }}</p>
                {% if template.notes %}
                  <p class="text-xs text-muted mb-2">{{ template.notes }}</p>
                {% endif %}
              </div>
              <div class="text-end">
                <div class="h5 mb-1" style="color: var(--navy);">¬£{{ "%.2f"|format(template.amount) }}</div>
                <form action="/invoices/templates/delete/{{ template.id }}" method="POST" 
                      onsubmit="return confirm('Delete this template?')" class="d-inline">
                  <button type="submit" class="btn-base btn-outline-danger btn-sm">
                    üóëÔ∏è
                  </button>
                </form>
              </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="d-flex gap-2">
              <a href="/invoices/create?template={{ template.id }}" class="btn-base btn-accent btn-sm flex-fill">
                üìù Use Template
              </a>
              <button onclick="copyTemplate('{{ template.name }}', '{{ template.description }}', {{ template.amount }}, '{{ template.notes }}')" 
                      class="btn-base btn-outline-accent btn-sm">
                üìã Copy
              </button>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
    
    <!-- Quick Stats -->
    <div class="mt-4 pt-3" style="border-top: 1px solid var(--light-border);">
      <div class="row text-center g-3">
        <div class="col-4">
          <div class="h5 mb-1" style="color: var(--navy);">{{ templates|length }}</div>
          <div class="text-xs text-muted">Templates</div>
        </div>
        <div class="col-4">
          <div class="h5 mb-1" style="color: var(--teal);">¬£{{ "%.0f"|format(templates|sum(attribute='amount')) }}</div>
          <div class="text-xs text-muted">Total Value</div>
        </div>
        <div class="col-4">
          <div class="h5 mb-1" style="color: var(--navy);">¬£{{ "%.0f"|format((templates|sum(attribute='amount')) / (templates|length)) }}</div>
          <div class="text-xs text-muted">Average</div>
        </div>
      </div>
    </div>
  {% else %}
    <div class="text-center" style="padding: 40px 20px;">
      <div style="font-size: 48px; margin-bottom: 15px;">üìã</div>
      <h5 class="mb-3">No Templates Yet</h5>
      <p class="text-muted mb-4">Create templates for your common services to speed up invoice creation!</p>
      
      <!-- Sample Template Suggestions -->
      <div class="row g-2 mb-4">
        <div class="col-md-4">
          <div class="card-border-left text-start" style="background-color: rgba(0, 160, 126, 0.05);">
            <div class="font-medium mb-1">Private Lesson</div>
            <div class="text-sm text-muted mb-2">1-hour private tennis lesson</div>
            <div class="text-sm font-medium">¬£40</div>
            <button onclick="fillSampleTemplate('Private Lesson', '1-hour private tennis lesson', 40)" 
                    class="btn-base btn-outline-accent btn-sm mt-2 w-100">
              Use This Sample
            </button>
          </div>
        </div>
        
        <div class="col-md-4">
          <div class="card-border-left text-start" style="background-color: rgba(0, 160, 126, 0.05);">
            <div class="font-medium mb-1">Group Session</div>
            <div class="text-sm text-muted mb-2">1-hour group coaching (4 players)</div>
            <div class="text-sm font-medium">¬£100</div>
            <button onclick="fillSampleTemplate('Group Session', '1-hour group coaching (4 players)', 100)" 
                    class="btn-base btn-outline-accent btn-sm mt-2 w-100">
              Use This Sample
            </button>
          </div>
        </div>
        
        <div class="col-md-4">
          <div class="card-border-left text-start" style="background-color: rgba(0, 160, 126, 0.05);">
            <div class="font-medium mb-1">Court Rental</div>
            <div class="text-sm text-muted mb-2">2-hour court rental</div>
            <div class="text-sm font-medium">¬£60</div>
            <button onclick="fillSampleTemplate('Court Rental', '2-hour court rental', 60)" 
                    class="btn-base btn-outline-accent btn-sm mt-2 w-100">
              Use This Sample
            </button>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
</div>

<!-- Tips -->
<div class="card-base" style="background-color: rgba(0, 160, 126, 0.05); border: 1px solid rgba(0, 160, 126, 0.2);">
  <h5 class="mb-3">üí° Template Tips</h5>
  <ul class="mb-0" style="padding-left: 1.2rem;">
    <li class="mb-2">Create templates for your most common services to save time</li>
    <li class="mb-2">Include clear descriptions so clients understand what they're paying for</li>
    <li class="mb-2">Use templates as starting points - you can always modify before sending</li>
    <li class="mb-0">Add payment terms in the notes section (e.g., "Payment due within 7 days")</li>
  </ul>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Fill sample template data into the form
  function fillSampleTemplate(name, description, amount) {
    document.querySelector('input[name="name"]').value = name;
    document.querySelector('input[name="description"]').value = description;
    document.querySelector('input[name="amount"]').value = amount;
    
    // Scroll to form
    document.querySelector('.card-base').scrollIntoView({ behavior: 'smooth' });
    
    // Focus on name field
    document.querySelector('input[name="name"]').focus();
  }
  
  // Copy template data to form (for editing)
  function copyTemplate(name, description, amount, notes) {
    document.querySelector('input[name="name"]').value = name + ' (Copy)';
    document.querySelector('input[name="description"]').value = description;
    document.querySelector('input[name="amount"]').value = amount;
    document.querySelector('textarea[name="notes"]').value = notes || '';
    
    // Scroll to form
    document.querySelector('.card-base').scrollIntoView({ behavior: 'smooth' });
    
    // Focus on name field and select the text
    const nameField = document.querySelector('input[name="name"]');
    nameField.focus();
    nameField.select();
  }
</script>
{% endblock %}