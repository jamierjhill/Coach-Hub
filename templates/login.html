{% extends "base.html" %}

{% block title %}ðŸŽ¾ Coach Login{% endblock %}

{% block body_class %}login-page{% endblock %}

{% block container_class %}container d-flex align-items-center justify-content-center{% endblock %}

{% block content %}
  <div style="max-width: 450px;" class="w-100">
    <div class="login-card tennis-card mx-auto">
      <!-- PWA Install Prompt -->
      <div class="install-prompt" id="installPrompt">
        ðŸ“± Install Tennis Toolbox as an app for quick access!
        <button id="installButton">Install</button>
        <button id="dismissButton">Later</button>
      </div>
      
      <h3 class="text-success text-center mb-4">ðŸŽ¾ Coaches Hub Login - BETA</h3>
      
      <!-- Coach Login -->
      <form method="POST" action="/login">
        <div class="mb-3">
          <label class="form-label">Username</label>
          <input type="text" name="username" class="form-control" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Password</label>
          <input type="password" name="password" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">Login as Coach</button>
      </form>

      <p class="text-center mt-3">
        <a href="/register" class="text-link">Create a new coach profile</a>
      </p>

      <hr class="my-4">

      <!-- Player Access Code -->
      <form method="POST" action="/player-access">
        <div class="mb-3">
          <label class="form-label">Player Access Code</label>
          <input type="text" name="access_code" class="form-control" placeholder="Enter code" required>
        </div>
        <button type="submit" class="btn btn-outline-primary w-100">Enter as Player</button>
      </form>
    </div>
  </div>
{% endblock %}

{% block footer %}{% endblock %}

{% block extra_js %}
<script>
  // PWA Installation Script
  let deferredPrompt;
  const installPrompt = document.getElementById('installPrompt');
  const installButton = document.getElementById('installButton');
  const dismissButton = document.getElementById('dismissButton');
  
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installPrompt.style.display = 'block';
  });
  
  installButton.addEventListener('click', async () => {
    if (deferredPrompt) {
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      console.log(`User response to the install prompt: ${outcome}`);
      deferredPrompt = null;
      installPrompt.style.display = 'none';
    }
  });
  
  dismissButton.addEventListener('click', () => {
    installPrompt.style.display = 'none';
  });
  
  // Hide prompt if already installed
  window.addEventListener('appinstalled', () => {
    installPrompt.style.display = 'none';
    deferredPrompt = null;
  });
  
  // Existing timeout script for alerts
  setTimeout(() => {
    document.querySelectorAll('.alert').forEach(alert => {
      alert.classList.remove('show');
      alert.classList.add('fade');
      setTimeout(() => alert.remove(), 500);
    });
  }, 5000);
</script>
{% endblock %}