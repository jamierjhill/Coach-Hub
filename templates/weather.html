<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>☀️ Weather Forecast</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="/static/colours.css" rel="stylesheet">
  <link href="/static/typography.css" rel="stylesheet">
</head>
<body>
  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}
  {% endwith %}
  
<div class="container py-4">
  <h2 class="text-success text-center mb-4">☀️ Weather Forecast</h2>

  <!-- Navigation Buttons -->
  <div class="text-center mb-3">
    <a href="{% if current_user.is_authenticated %}/home{% else %}/login{% endif %}" class="btn btn-outline-success me-2">🏠 Home</a>
    <a href="/settings" class="btn btn-outline-success">⚙️ Change Location</a>
  </div>

  <!-- Location Display -->
  <div class="card-section">
    <h4>📍 {{ weather.location }}</h4>
    <div class="row align-items-center">
      {% if weather.forecast|length > 0 %}
      {% set today = weather.forecast[0] %}
      <div class="col-md-8">
        {% if today.good_for_tennis %}
          <p class="mb-0 text-success fw-bold">✅ Good conditions for tennis today!</p>
        {% else %}
          <p class="mb-0 text-warning fw-bold">⚠️ Weather conditions may impact play today</p>
        {% endif %}
      </div>
      <div class="col-md-4 text-end">
        {% if today.hourly|length > 0 %}
          <div class="d-flex align-items-center justify-content-md-end">
            <img 
              src="https://openweathermap.org/img/wn/{{ today.hourly[0].icon }}@2x.png" 
              alt="{{ today.hourly[0].desc }}"
              class="me-2"
              style="width: 70px; height: 70px;"
            >
            <span class="temp-display">{{ today.hourly[0].temp|round(0) }}°C</span>
          </div>
        {% endif %}
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Day Tabs -->
  <div class="card-section">
    <h4>🗓️ 5-Day Forecast</h4>

    <ul class="nav nav-tabs" id="weatherTabs" role="tablist">
      {% for day in weather.forecast %}
      <li class="nav-item" role="presentation">
        <button 
          class="nav-link {% if loop.index == 1 %}active{% endif %}" 
          id="day{{ loop.index }}-tab" 
          data-bs-toggle="tab" 
          data-bs-target="#day{{ loop.index }}" 
          type="button" 
          role="tab" 
          aria-controls="day{{ loop.index }}" 
          aria-selected="{{ 'true' if loop.index == 1 else 'false' }}"
        >
          {{ day.day.split(' ')[0] }}
          {% if day.good_for_tennis %}🎾{% else %}☔{% endif %}
        </button>
      </li>
      {% endfor %}
    </ul>

    <!-- Tab Contents -->
    <div class="tab-content" id="weatherTabContent">
      {% for day in weather.forecast %}
      <div 
        class="tab-pane fade {% if loop.index == 1 %}show active{% endif %}" 
        id="day{{ loop.index }}" 
        role="tabpanel" 
        aria-labelledby="day{{ loop.index }}-tab"
      >
        <h5 class="mb-3">{{ day.day }}</h5>
        
        {% if day.good_for_tennis %}
          <div class="weather-status status-good">
            🎾 Good conditions for tennis - perfect for coaching sessions!
          </div>
        {% else %}
          <div class="weather-status status-bad">
            ⚠️ Weather conditions may not be ideal for tennis - consider indoor options or adjusting plans.
          </div>
        {% endif %}

        <!-- Hourly forecast scrolling row -->
        <div class="forecast-scroll-row">
          {% for hour in day.hourly %}
            <div class="period-block">
              <div class="period-time">{{ hour.time }}</div>
              <div class="weather-icon-wrapper">
                <img src="https://openweathermap.org/img/wn/{{ hour.icon }}.png" class="weather-icon-small" alt="{{ hour.desc }}">
              </div>
              <div class="period-temp">{{ hour.temp|round(0) }}°C</div>
              <div class="period-desc">{{ hour.desc }}</div>
              <div class="period-metrics">
                <span><i class="weather-icon-tiny">💨</i> {{ (hour.wind * 2.237)|round(0) }}mph</span>
                <span><i class="weather-icon-tiny">🌧️</i> {{ (hour.rain * 10)|round(0) }}%</span>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Tennis Tips Section -->
  {% if weather.forecast|length > 0 %}
  {% set today = weather.forecast[0] %}
  {% if today.hourly|length > 0 %}
  {% set current = today.hourly[0] %}
  <div class="card-section">
    <h4>🎯 Tennis Tips for Today's Weather</h4>
    
    {% if current.temp > 25 %}
    <!-- Hot Weather Tips -->
    <div class="tips-card">
      <div class="tips-title">🔥 Hot Weather Tips</div>
      <ul class="mb-0">
        <li>Bring extra water and stay hydrated</li>
        <li>Wear light-colored, breathable clothing</li>
        <li>Consider scheduling breaks in the shade</li>
        <li>Apply sunscreen regularly</li>
      </ul>
    </div>
    {% elif current.temp < 10 %}
    <!-- Cold Weather Tips -->
    <div class="tips-card">
      <div class="tips-title">❄️ Cold Weather Tips</div>
      <ul class="mb-0">
        <li>Warm up thoroughly before playing</li>
        <li>Layer your clothing appropriately</li>
        <li>Keep moving between points to stay warm</li>
        <li>Consider using warmer tennis balls</li>
      </ul>
    </div>
    {% elif current.rain > 0.2 %}
    <!-- Rainy Weather Tips -->
    <div class="tips-card">
      <div class="tips-title">🌧️ Rainy Weather Advice</div>
      <ul class="mb-0">
        <li>Check if indoor courts are available</li>
        <li>Be cautious on wet surfaces</li>
        <li>Bring extra towels and grip tape</li>
        <li>Have a waterproof bag for your equipment</li>
      </ul>
    </div>
    {% elif current.wind > 5 %}
    <!-- Windy Weather Tips -->
    <div class="tips-card">
      <div class="tips-title">💨 Windy Conditions Tips</div>
      <ul class="mb-0">
        <li>Adjust your serving toss height</li>
        <li>Add more spin to keep the ball under control</li>
        <li>Consider playing with heavier balls</li>
        <li>Be prepared to adjust your tactics based on wind direction</li>
      </ul>
    </div>
    {% else %}
    <!-- Ideal Weather Tips -->
    <div class="tips-card">
      <div class="tips-title">✅ Ideal Conditions Tips</div>
      <ul class="mb-0">
        <li>Great day for skill development and technique work</li>
        <li>Perfect time for recording video of players' form</li>
        <li>Consider extending practice sessions if players are up for it</li>
        <li>Take advantage of conditions for match play</li>
      </ul>
    </div>
    {% endif %}
  </div>
  {% endif %}
  {% endif %}

  <!-- Planning Section -->
  <div class="card-section">
    <h4>📆 Plan Your Sessions</h4>
    <p>Use this weather forecast to help plan your upcoming tennis sessions.</p>
    <div class="row g-3">
      <div class="col-md-6">
        <a href="/calendar" class="btn btn-outline-success w-100">📅 Go to Calendar</a>
      </div>
      <div class="col-md-6">
        <a href="/ai-toolbox" class="btn btn-outline-success w-100">🎾 Create Session Plans</a>
      </div>
    </div>
  </div>
</div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>